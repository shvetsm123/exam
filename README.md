
# Проект Squadhelp

Squadhelp - биржа по созданию названия, слогана и логотипа для Вашей новой компании/сайта/проекта. Проект использует PostgreSQL в качестве базы данных (ранее часть функционала, а именно - чаты, хранились в MongoDB).

Пользователь с ролью Заказчика (`Customer`) может выбрать услугу по созданию необходимого контента (`Contest`) и оплатить ее, а с ролью Создателя (`Creator`) - предложить вариант контента (`Offer`), согласно техническому заданию Заказчика.

Заказчик сможет увидеть преложенный вариант контента только после того, как пользователь с ролью модератора (`Moder`) проверит и утвердит ее. Сообщение об утверждении или отказе будет отправлено на электронную почту Заказчика.


# Запуск проекта

Склонируйте проект

```bash
  git clone https://github.com/shvetsm123/exam
```

Перейдите в директорию проекта

```bash
  cd exam
```

В корневой папке выполните команду по установке проекта

```bash
  docker compose --file ./docker-compose-dev.yaml up --build
```

Перейдите на локальный адрес для открытия проекта в браузере 

```bash
  http://localhost:5000/
```
# Конфиг PostgreSQL

Настройки по подключению БД находятся в `server/src/config/postgresConfig.json`.



# Задания проекта

- Bugs fix
- Layout
- React Events and Timers
- React Button Group
- DB No-SQL MongoDB
- DB SQL Migration
- DB SQL SQL queries
- Node.js Logger
- Full Stack Create Moderator role
- Full Stack Chats from MongoBD to Sequelize

## Bugs fix

Выполнено исправление всех багов, ошибки и предупреждения убраны.

## Layout

Выполнена верстка страницы How It Works. 

Страница помещена в выпадающий список навигации главного меню `CONTESTS/HOW IT WORKS`, а также доступна по ссылке `http://localhost:5000/how-it-works`.

Исходный код - `/client/http-task`

## React Events and Timers

Выполнена реализация страницы Events и таймера с напоминаниями.

Страница помещена в выпадающий список навигации главного меню `Blog/EVENTS`, а также доступна по ссылке `http://localhost:5000/events`.

Исходный код - `/client/src/pages/Events`.

## React Button Group

Выполнена верстка компонента Button Group.

Компонент помещен в конец страницы `START CONTEST` по адресу `http://localhost:5000/startContest`.

Исходный код - `/client/src/components/ButtonGroup`.

## DB No-SQL MongoDB

С помощью агрегационной функции выполнен поиск и подсчет записей в коллекции `Messages`, которые содержат слово `Паровоз`.

Исходный код - `/server/nosql.js`.

## DB SQL Migration

Выполнена разработка структуры БД с использованием SQL-запросов, а также добавлен скриншот со схемой БД. 

Исходный код - `/server/sandbox.js`.

Скриншот - `/server/task8.png`.


## DB SQL Migration

Выполнены запросы/изменения в БД с использованием SQL-запросов.

Исходный код - `/server/sandbox.js`.

## Node.js Logger

Выполнены логгер ошибок на сервере, а также перезапись всех текущих ошибок в новый файл и очистка старого файла.

Исходный код - `/server/src/errorLogger.js`.

Добавлен функционал в `/server/src/index.js`.

## Full Stack Create Moderator role

Выполнено добавление роли `MODER` и статуса `ModerStatus` с помощью миграций, реализации `ModerStatus` при создании `Offer`, создание `ModerPanel`, а также отправки электронного письма при смене `ModerStatus`.

Присвоить роль модератора - `UPDATE "Users"
SET role = 'moder'
WHERE id = <id_number>;`

## Full Stack Chats from MongoBD to Sequelize

Выполнен переход чатов с MongoDB на Sequelize с помощью моделей и миграций, изменен `chatController` и внесены изменения на клиент, касающиеся чатов.

Исходный код - `/server/src/controllers/chatController.js`.

________________________________________________________________________________

# Правки (ветка MAIN)

## 1. Bugs fix
1.1. Убрал console.log и комментарии на продакшене, загрузив плагины* для babel и изменив .babelrc*;

1.2. Привел все компоненты к единому стилю пропсов - деструктуризации;

!1.3. Вынос функций из jsx в логику компонента, а также использование готовых пакетов реализовано в 3. React Events and Timers;

## 2. Layout
2.1. Выравнял все элементы как в оригинале, изменил размеры шрифтов и отступы

2.2. Изменил логику FAQ - сделал первый пункт каждого раздела открытый, а при выборе другого пункта - предыдущий пункт скрывается

## 3. React Events and Timers
3.1. Сделал Events только для customer (buyer) и поместил в выпадающее меню учетной записи.

3.2. Подключил store и прокинул в него количество завершенных событий

3.3. Используя store, установил бейджик в выпадающем меню напротив пункта меню 'Events' (по умолчанию пустое, при завершении появляется цифра завершенных событий)

3.4. Добавил Formik + Yup, а также валидацию Notify Before

3.5. Общий рефакторинг, в том числе очистка jsx от javascript

3.6. Переименовал хук TimerUtils -> useTimerUtils

## 4. React Button Group
4.1. Изменил логику - при нажатии на кнопку она становится активной, остальные - остаются серыми.

4.2. Вынес контент из jsx и промапил его

## 7. DB SQL SQL queries
7.1. Изменил логику, при которой высчитываю сумму всех завершенных заказов за указанный период, затем высчитываю 10% от этой суммы и добавляю эти 10% к балансу пользователей роли 'customer'.

## 8. Node.js Logger creation
8.1. Добавил cron, убрал setInterval

## 9. Full Stack Create moderation functionality
9.1. Вывел название контеста и имя креатора вместо id

9.2. Исправил логику - после resolve/reject из списка удаляется текущий offer без перезагрузки страницы

9.3. Исправил логику - если customer принял offer, то все остальные offer'ы в панели модератора пропадают (получают moderStatus - reject). 

9.4. Исправил логику - после принятия оффера, все остальные отклоняются без перезагрузки страницы

## 10. Full Stack Change chat controllers for SQL
10.1. Исправил чат - теперь он работает в realtime

